{{ define "main" }}
<div class="section">
    <div class="columns is-centered">
        <div class="column is-full-mobile is-half-desktop" style="border-radius: 1%; box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19)">
            <div class="is-flex" style="justify-content: center; border-radius: 3%; background-color: #f0f5f1; position: relative;">
                <figure class="image"> 
                    <img style="border-radius: 3%; width: {{.Params.Image_width}}px; height: {{.Params.Image_height}}px" src={{ printf "%s%s" .Site.BaseURL .Params.Recipe_image }} alt="Placeholder image">
                </figure>
                <div id="printButton" style="position: absolute; bottom: 0; right: 0;" class="is-rounded">
                    <a href="/print/{{ urlize .File.BaseFileName }}/print.html" target="_blank"><i class="fas fa-print fa-3x"></i></a>
                </div>
            </div>
            
            <div class="container has-text-centered">
                <h1 class="title is-bold"> {{ .Title }}</h1>
                <p class="subtitle is-italic"> {{ .Params.Author }}</p>
                <div class="container has-text-right">
                    {{ partial "metadata.html" . }}
                </div>
                <hr>
            </div>
            <div class="container has-text-centered">    
                {{ partial "statstable.html" . }}
            </div>
            <hr>
            <p class="subtitle is-italic"> {{ .Params.Tagline }}</p>
            {{ if .Params.steps }}
            <div class="content recipe-steps">
                <h2>Steps</h2>
                {{ range $index, $step := .Params.steps }}
                <div class="box recipe-step">
                    {{ if $step.ingredients }}
                    <div class="columns is-vcentered">
                        <div class="column is-one-third">
                            <h4 class="title is-6">Ingredients</h4>
                            <ul class="recipe-ingredients">
                                {{ range $step.ingredients }}
                                {{ $isMap := reflect.IsMap . }}
                                {{ if and $isMap (isset . "amount") }}
                                {{ $unit := .unit | default "" }}
                                {{ $unitPlural := .unit_plural | default "" }}
                                {{ $item := .item | default "" }}
                                {{ $note := .note | default "" }}
                                {{ $scalable := true }}
                                {{ if isset . "scalable" }}
                                {{ $scalable = .scalable }}
                                {{ end }}
                                <li class="recipe-ingredient" data-scalable="{{ $scalable }}">
                                    <span class="recipe-ingredient-amount" data-base-amount="{{ .amount }}" data-base-unit="{{ $unit }}" data-base-unit-plural="{{ $unitPlural }}">{{ .amount }}{{ if $unit }} {{ $unit }}{{ end }}</span>{{ if $item }} <span class="recipe-ingredient-name">{{ $item | markdownify }}</span>{{ end }}{{ if $note }}<span class="recipe-ingredient-note">, {{ $note | markdownify }}</span>{{ end }}
                                </li>
                                {{ else if and $isMap (isset . "item") }}
                                <li>{{ .item | markdownify }}{{ if .note }}, {{ .note | markdownify }}{{ end }}</li>
                                {{ else }}
                                <li>{{ . }}</li>
                                {{ end }}
                                {{ end }}
                            </ul>
                        </div>
                        <div class="column">
                            <h4 class="title is-6">Step {{ add $index 1 }}</h4>
                            <div class="recipe-step-text">
                                {{ $step.text | markdownify }}
                            </div>
                        </div>
                    </div>
                    {{ else }}
                    <div>
                        <h4 class="title is-6">Step {{ add $index 1 }}</h4>
                        <div class="recipe-step-text">
                            {{ $step.text | markdownify }}
                        </div>
                    </div>
                    {{ end }}
                </div>
                {{ end }}
            </div>
            {{ if .Content }}
            <div class="content recipe-notes">
                {{ .Content }}
            </div>
            {{ end }}
            {{ else }}
            <div class="content">
                {{ .Content }}
            </div>
            {{ end }}
        </div>
    </div>
</div>
{{ end }}
